<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Call Center Dashboard - GOOD TEAM CRM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
        }
        
        .particle-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .content-container {
            position: relative;
            z-index: 10;
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .animate-in {
            opacity: 0;
            transform: translateY(20px);
        }
        
        .sidebar-item {
            transition: all 0.3s ease;
        }
        
        .sidebar-item:hover {
            background: rgba(59, 130, 246, 0.1);
            transform: translateX(5px);
        }
        
        .sidebar-item.active {
            background: rgba(59, 130, 246, 0.2);
            border-right: 3px solid #3b82f6;
        }
        
        .metric-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
            backdrop-filter: blur(10px);
        }
        
        .notification-badge {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .lead-card {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        
        .lead-card:hover {
            border-left-color: #3b82f6;
            transform: translateX(4px);
        }
        
        .lead-card.paid {
            border-left-color: #10b981;
        }
        
        .lead-card.priority {
            border-left-color: #ef4444;
        }
        
        .call-status-btn {
            transition: all 0.2s ease;
        }
        
        .call-status-btn:hover {
            transform: scale(1.05);
        }
        
        .call-status-btn.done {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        .call-status-btn.busy {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }
        
        .call-status-btn.no-answer {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        .timer-display {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .script-highlight {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-left: 4px solid #f59e0b;
        }
    </style>
</head>
<body>
    <!-- Particle Background -->
    <div class="particle-container"></div>
    
    <!-- Main Content -->
    <div class="content-container">
        <!-- Navigation -->
        <nav class="bg-white/80 backdrop-blur-lg border-b border-gray-200 sticky top-0 z-40">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center space-x-4">
                        <img src="resources/logo.png" alt="GOOD TEAM" class="h-8 w-8">
                        <h1 class="text-xl font-bold text-gray-900">GOOD TEAM CRM</h1>
                        <span class="text-sm text-gray-500">Call Center</span>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <!-- Call Timer -->
                        <div class="flex items-center space-x-2">
                            <div id="callTimer" class="timer-display text-blue-600 hidden">00:00</div>
                            <button id="endCallBtn" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-lg text-sm transition-colors hidden">
                                –ó–∞–≤–µ—Ä—à–∏—Ç—å
                            </button>
                        </div>
                        
                        <!-- Attendance Clock -->
                        <div class="flex items-center space-x-2">
                            <button id="clockInBtn" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded-lg text-sm transition-colors">
                                –í–æ–π—Ç–∏
                            </button>
                            <button id="clockOutBtn" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-lg text-sm transition-colors hidden">
                                –í—ã–π—Ç–∏
                            </button>
                            <span id="workTime" class="text-sm text-gray-600">00:00:00</span>
                        </div>
                        
                        <!-- Notification Bell -->
                        <button id="notificationBell" class="relative p-2 text-gray-600 hover:text-gray-900 transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5zM10.5 3.5a6 6 0 0 1 6 6v1.5a6 6 0 0 0 2.5 4.5H6a6 6 0 0 0 2.5-4.5V9.5a6 6 0 0 1 6-6z"></path>
                            </svg>
                            <span id="notificationBadge" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center notification-badge" style="display: none;">0</span>
                        </button>
                        
                        <!-- User Profile -->
                        <div class="flex items-center space-x-3">
                            <img id="currentUserAvatar" src="resources/user-avatars/avatar4.jpg" alt="User" class="h-8 w-8 rounded-full">
                            <div>
                                <p id="currentUserName" class="text-sm font-medium text-gray-900">–ï–ª–µ–Ω–∞ –í–æ–ª–∫–æ–≤–∞</p>
                                <p id="currentUserRole" class="text-xs text-gray-500">Call Center –û–ø–µ—Ä–∞—Ç–æ—Ä</p>
                            </div>
                            <button id="logoutBtn" class="text-gray-600 hover:text-gray-900 transition-colors">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <div class="flex">
            <!-- Sidebar -->
            <div class="w-64 bg-white/80 backdrop-blur-lg border-r border-gray-200 min-h-screen">
                <div class="p-4">
                    <nav class="space-y-2">
                        <a href="#dashboard" class="sidebar-item active flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:text-gray-900">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"></path>
                            </svg>
                            <span>–û–±–∑–æ—Ä</span>
                        </a>
                        
                        <a href="#assigned-leads" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:text-gray-900">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            <span>–ù–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –ª–∏–¥—ã</span>
                        </a>
                        
                        <a href="#active-call" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:text-gray-900">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                            </svg>
                            <span>–ê–∫—Ç–∏–≤–Ω—ã–π –∑–≤–æ–Ω–æ–∫</span>
                        </a>
                        
                        <a href="#scripts" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:text-gray-900">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            <span>–°–∫—Ä–∏–ø—Ç—ã</span>
                        </a>
                        
                        <a href="#my-stats" class="sidebar-item flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:text-gray-900">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                            <span>–ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
                        </a>
                    </nav>
                </div>
            </div>

            <!-- Main Content -->
            <div class="flex-1 p-6">
                <!-- Dashboard Overview -->
                <div id="dashboard" class="section-content">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold text-gray-900 mb-2">–û–±–∑–æ—Ä Call Center</h2>
                        <p class="text-gray-600">–í–∞—à–∏ –ª–∏–¥—ã –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏</p>
                    </div>

                    <!-- Metrics Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <!-- Total Assigned Leads -->
                        <div class="metric-card rounded-2xl p-6 card-hover animate-in">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">–ù–∞–∑–Ω–∞—á–µ–Ω–æ –ª–∏–¥–æ–≤</p>
                                    <p id="assignedLeadsCount" class="text-3xl font-bold text-gray-900">0</p>
                                </div>
                                <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <!-- Processed Today -->
                        <div class="metric-card rounded-2xl p-6 card-hover animate-in">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Å–µ–≥–æ–¥–Ω—è</p>
                                    <p id="processedToday" class="text-3xl font-bold text-gray-900">0</p>
                                </div>
                                <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                                    <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <!-- Success Rate -->
                        <div class="metric-card rounded-2xl p-6 card-hover animate-in">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">–£—Å–ø–µ—à–Ω—ã—Ö –∑–≤–æ–Ω–∫–æ–≤</p>
                                    <p id="successRate" class="text-3xl font-bold text-gray-900">0%</p>
                                </div>
                                <div class="w-12 h-12 bg-emerald-100 rounded-full flex items-center justify-center">
                                    <svg class="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <!-- Queue Length -->
                        <div class="metric-card rounded-2xl p-6 card-hover animate-in">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">–í –æ—á–µ—Ä–µ–¥–∏</p>
                                    <p id="queueLength" class="text-3xl font-bold text-gray-900">0</p>
                                </div>
                                <div class="w-12 h-12 bg-amber-100 rounded-full flex items-center justify-center">
                                    <svg class="w-6 h-6 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="bg-white/80 backdrop-blur-lg rounded-2xl p-6 card-hover animate-in mb-8">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <button onclick="callCenterDashboard.showSection('assigned-leads')" class="flex items-center justify-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition-colors">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                                <span>–ù–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –ª–∏–¥—ã</span>
                            </button>
                            
                            <button onclick="callCenterDashboard.showSection('active-call')" class="flex items-center justify-center space-x-2 bg-green-600 hover:bg-green-700 text-white py-3 px-4 rounded-lg transition-colors">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                                </svg>
                                <span>–ê–∫—Ç–∏–≤–Ω—ã–π –∑–≤–æ–Ω–æ–∫</span>
                            </button>
                            
                            <button onclick="callCenterDashboard.showSection('scripts')" class="flex items-center justify-center space-x-2 bg-amber-600 hover:bg-amber-700 text-white py-3 px-4 rounded-lg transition-colors">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                                <span>–°–∫—Ä–∏–ø—Ç—ã</span>
                            </button>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="bg-white/80 backdrop-blur-lg rounded-2xl p-6 card-hover animate-in">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">–ú–æ—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h3>
                        <div id="recentActivity" class="space-y-4">
                            <!-- Activity will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Assigned Leads Section -->
                <div id="assigned-leads" class="section-content hidden">
                    <div class="mb-8">
                        <div class="flex justify-between items-center">
                            <div>
                                <h2 class="text-3xl font-bold text-gray-900 mb-2">–ù–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –ª–∏–¥—ã</h2>
                                <p class="text-gray-600">–õ–∏–¥—ã, –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏</p>
                            </div>
                            <div class="flex space-x-2">
                                <input type="text" id="leadsSearch" placeholder="–ü–æ–∏—Å–∫ –ª–∏–¥–æ–≤..." 
                                       class="px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                <select id="leadsFilter" class="px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                    <option value="all">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                                    <option value="new">–ù–æ–≤—ã–µ</option>
                                    <option value="in_progress">–í —Ä–∞–±–æ—Ç–µ</option>
                                    <option value="priority">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ</option>
                                    <option value="paid">–û–ø–ª–∞—á–µ–Ω—ã</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div id="assignedLeadsList" class="space-y-4">
                        <!-- Assigned leads will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Active Call Section -->
                <div id="active-call" class="section-content hidden">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold text-gray-900 mb-2">–ê–∫—Ç–∏–≤–Ω—ã–π –∑–≤–æ–Ω–æ–∫</h2>
                        <p class="text-gray-600">–¢–µ–∫—É—â–∏–π –∑–≤–æ–Ω–æ–∫ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–º</p>
                    </div>

                    <div id="activeCallContainer" class="space-y-6">
                        <!-- No active call state -->
                        <div id="noActiveCall" class="bg-white/80 backdrop-blur-lg rounded-2xl p-8 text-center card-hover animate-in">
                            <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                            </svg>
                            <h3 class="text-xl font-semibold text-gray-900 mb-2">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–∞</h3>
                            <p class="text-gray-600 mb-6">–í—ã–±–µ—Ä–∏—Ç–µ –ª–∏–¥ –∏–∑ —Å–ø–∏—Å–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –¥–ª—è –Ω–∞—á–∞–ª–∞ –∑–≤–æ–Ω–∫–∞</p>
                            <button onclick="callCenterDashboard.showSection('assigned-leads')" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors">
                                –í—ã–±—Ä–∞—Ç—å –ª–∏–¥
                            </button>
                        </div>

                        <!-- Active call interface (hidden by default) -->
                        <div id="activeCallInterface" class="hidden space-y-6">
                            <!-- Lead Info Card -->
                            <div class="bg-white/80 backdrop-blur-lg rounded-2xl p-6 card-hover animate-in">
                                <div id="activeLeadInfo">
                                    <!-- Lead information will be populated when call starts -->
                                </div>
                            </div>

                            <!-- Call Controls -->
                            <div class="bg-white/80 backdrop-blur-lg rounded-2xl p-6 card-hover animate-in">
                                <h3 class="text-lg font-semibold text-gray-900 mb-4">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–≤–æ–Ω–∫–æ–º</h3>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <button onclick="callCenterDashboard.markCallStatus('done')" 
                                            class="call-status-btn done text-white py-4 px-6 rounded-lg font-semibold">
                                        ‚úÖ –£—Å–ø–µ—à–Ω–æ
                                    </button>
                                    <button onclick="callCenterDashboard.markCallStatus('busy')" 
                                            class="call-status-btn busy text-white py-4 px-6 rounded-lg font-semibold">
                                        üìû –ó–∞–Ω—è—Ç–æ
                                    </button>
                                    <button onclick="callCenterDashboard.markCallStatus('no_answer')" 
                                            class="call-status-btn no-answer text-white py-4 px-6 rounded-lg font-semibold">
                                        ‚ùå –ù–µ—Ç –æ—Ç–≤–µ—Ç–∞
                                    </button>
                                </div>
                            </div>

                            <!-- Call Notes -->
                            <div class="bg-white/80 backdrop-blur-lg rounded-2xl p-6 card-hover animate-in">
                                <h3 class="text-lg font-semibold text-gray-900 mb-4">–ó–∞–º–µ—Ç–∫–∏ –ø–æ –∑–≤–æ–Ω–∫—É</h3>
                                <textarea id="callNotes" rows="4" 
                                          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                          placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–º–µ—Ç–∫–∏ –æ —Ä–∞–∑–≥–æ–≤–æ—Ä–µ..."></textarea>
                                <div class="flex justify-end mt-4">
                                    <button onclick="callCenterDashboard.saveCallNotes()" 
                                            class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–º–µ—Ç–∫–∏
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Scripts Section -->
                <div id="scripts" class="section-content hidden">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold text-gray-900 mb-2">–°–∫—Ä–∏–ø—Ç—ã</h2>
                        <p class="text-gray-600">–°–ø—Ä–∞–≤–æ—á–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏</p>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Scripts Sidebar -->
                        <div class="lg:col-span-1">
                            <div class="bg-white/80 backdrop-blur-lg rounded-2xl p-6 card-hover animate-in">
                                <h3 class="text-lg font-semibold text-gray-900 mb-4">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
                                <div class="space-y-2">
                                    <button onclick="filterScripts('all')" class="w-full text-left px-3 py-2 rounded-lg bg-blue-50 text-blue-700 text-sm font-medium">
                                        –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã
                                    </button>
                                    <button onclick="filterScripts('–ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ')" class="w-full text-left px-3 py-2 rounded-lg hover:bg-gray-50 text-gray-700 text-sm">
                                        –ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ
                                    </button>
                                    <button onclick="filterScripts('–í–æ–∑—Ä–∞–∂–µ–Ω–∏—è')" class="w-full text-left px-3 py-2 rounded-lg hover:bg-gray-50 text-gray-700 text-sm">
                                        –í–æ–∑—Ä–∞–∂–µ–Ω–∏—è
                                    </button>
                                    <button onclick="filterScripts('–ó–∞–∫—Ä—ã—Ç–∏–µ')" class="w-full text-left px-3 py-2 rounded-lg hover:bg-gray-50 text-gray-700 text-sm">
                                        –ó–∞–∫—Ä—ã—Ç–∏–µ
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Scripts Content -->
                        <div class="lg:col-span-2">
                            <div class="bg-white/80 backdrop-blur-lg rounded-2xl p-6 card-hover animate-in">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-semibold text-gray-900">–°–∫—Ä–∏–ø—Ç—ã</h3>
                                    <input type="text" id="scriptsSearch" placeholder="–ü–æ–∏—Å–∫ —Å–∫—Ä–∏–ø—Ç–æ–≤..." 
                                           class="px-3 py-2 border border-gray-300 rounded-lg text-sm">
                                </div>
                                <div id="scriptsList" class="space-y-4">
                                    <!-- Scripts will be populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- My Stats Section -->
                <div id="my-stats" class="section-content hidden">
                    <div class="mb-8">
                        <h2 class="text-3xl font-bold text-gray-900 mb-2">–ú–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                        <p class="text-gray-600">–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤–∞—à–µ–π —Ä–∞–±–æ—Ç–µ</p>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <!-- Performance Chart -->
                        <div class="bg-white/80 backdrop-blur-lg rounded-2xl p-6 card-hover animate-in">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ –Ω–µ–¥–µ–ª—é</h3>
                            <div id="performanceChart" style="height: 300px;"></div>
                        </div>

                        <!-- Call Results Chart -->
                        <div class="bg-white/80 backdrop-blur-lg rounded-2xl p-6 card-hover animate-in">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–≤–æ–Ω–∫–æ–≤</h3>
                            <div id="callResultsChart" style="height: 300px;"></div>
                        </div>
                    </div>

                    <!-- Detailed Stats -->
                    <div class="bg-white/80 backdrop-blur-lg rounded-2xl p-6 card-hover animate-in">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="text-center">
                                <p class="text-2xl font-bold text-blue-600" id="totalCalls">0</p>
                                <p class="text-sm text-gray-600">–í—Å–µ–≥–æ –∑–≤–æ–Ω–∫–æ–≤</p>
                            </div>
                            <div class="text-center">
                                <p class="text-2xl font-bold text-green-600" id="successfulCalls">0</p>
                                <p class="text-sm text-gray-600">–£—Å–ø–µ—à–Ω—ã—Ö</p>
                            </div>
                            <div class="text-center">
                                <p class="text-2xl font-bold text-amber-600" id="avgCallTime">0 –º–∏–Ω</p>
                                <p class="text-sm text-gray-600">–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals will be added here -->
    <div id="modalContainer"></div>

    <!-- JavaScript -->
    <script src="main.js"></script>
    
    <script>
        // Call Center Dashboard specific functionality
        class CallCenterDashboard {
            constructor() {
                this.currentSection = 'dashboard';
                this.activeCallLead = null;
                this.callStartTime = null;
                this.callTimer = null;
                this.attendanceStartTime = null;
                this.workTimer = null;
                this.init();
            }

            init() {
                this.setupNavigation();
                this.loadDashboard();
                this.loadAssignedLeads();
                this.loadScripts();
                this.setupAttendance();
                this.setupFilters();
                this.initializeCharts();
                this.loadStats();
            }

            setupNavigation() {
                const sidebarItems = document.querySelectorAll('.sidebar-item');
                sidebarItems.forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        const section = item.getAttribute('href').substring(1);
                        this.showSection(section);
                    });
                });
            }

            showSection(sectionName) {
                // Hide all sections
                document.querySelectorAll('.section-content').forEach(section => {
                    section.classList.add('hidden');
                });

                // Show selected section
                const targetSection = document.getElementById(sectionName);
                if (targetSection) {
                    targetSection.classList.remove('hidden');
                    this.currentSection = sectionName;
                }

                // Update active sidebar item
                document.querySelectorAll('.sidebar-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                const activeItem = document.querySelector(`[href="#${sectionName}"]`);
                if (activeItem) {
                    activeItem.classList.add('active');
                }
            }

            loadDashboard() {
                const assignedLeads = this.getAssignedLeads();
                const processedToday = this.getProcessedToday();
                const successRate = this.calculateSuccessRate();
                const queueLength = assignedLeads.filter(lead => lead.status === 'new').length;
                
                document.getElementById('assignedLeadsCount').textContent = assignedLeads.length;
                document.getElementById('processedToday').textContent = processedToday;
                document.getElementById('successRate').textContent = successRate + '%';
                document.getElementById('queueLength').textContent = queueLength;
                
                this.loadRecentActivity();
            }

            getAssignedLeads() {
                if (!window.crm || !window.crm.currentUser) return [];
                
                // Show leads that are:
                // 1. Created by TTC operators (not call center operators)
                // 2. Assigned to current call center operator OR not yet assigned
                return window.crm.leads.filter(lead => {
                    const creator = window.crm.users.find(user => user.id === lead.createdBy);
                    return creator && creator.role === 'ttc' && 
                           (lead.assignedTo === window.crm.currentUser.id || lead.assignedTo === null);
                });
            }

            getProcessedToday() {
                const today = new Date().toDateString();
                const myCallAttempts = window.crm?.callAttempts.filter(attempt => {
                    const attemptDate = new Date(attempt.timestamp).toDateString();
                    return attemptDate === today && attempt.operatorId === window.crm.currentUser.id;
                }) || [];
                
                return myCallAttempts.length;
            }

            calculateSuccessRate() {
                const myCallAttempts = window.crm?.callAttempts.filter(attempt => 
                    attempt.operatorId === window.crm.currentUser.id
                ) || [];
                
                if (myCallAttempts.length === 0) return 0;
                
                const successfulCalls = myCallAttempts.filter(attempt => attempt.callResult === 'done').length;
                return Math.round((successfulCalls / myCallAttempts.length) * 100);
            }

            loadRecentActivity() {
                const container = document.getElementById('recentActivity');
                const myCallAttempts = window.crm?.callAttempts.filter(attempt => 
                    attempt.operatorId === window.crm.currentUser.id
                ).slice(-5) || [];
                
                container.innerHTML = myCallAttempts.map(attempt => {
                    const lead = window.crm?.leads.find(l => l.id === attempt.leadId);
                    const statusColors = {
                        'done': 'bg-green-100 text-green-800',
                        'busy': 'bg-yellow-100 text-yellow-800',
                        'no_answer': 'bg-red-100 text-red-800'
                    };
                    
                    return `
                        <div class="flex items-center space-x-4 p-3 bg-gray-50 rounded-lg">
                            <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                                <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                                </svg>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm font-medium text-gray-900">${lead ? lead.leadName : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ª–∏–¥'}</p>
                                <p class="text-xs text-gray-500">–ü–æ–ø—ã—Ç–∫–∞ #${attempt.attemptNumber} ‚Ä¢ ${attempt.timestamp}</p>
                            </div>
                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${statusColors[attempt.callResult] || 'bg-gray-100 text-gray-800'}">
                                ${attempt.callResult === 'done' ? '–£—Å–ø–µ—à–Ω–æ' : 
                                  attempt.callResult === 'busy' ? '–ó–∞–Ω—è—Ç–æ' : '–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞'}
                            </span>
                        </div>
                    `;
                }).join('') || '<p class="text-gray-500 text-center py-8">–ù–µ—Ç –Ω–µ–¥–∞–≤–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</p>';
            }

            loadAssignedLeads() {
                const assignedLeads = this.getAssignedLeads();
                const container = document.getElementById('assignedLeadsList');
                
                if (assignedLeads.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-12">
                            <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            <h3 class="text-lg font-medium text-gray-900 mb-2">–ù–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –ª–∏–¥–æ–≤</h3>
                            <p class="text-gray-500">–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –ª–∏–¥–æ–≤</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = assignedLeads.map(lead => `
                    <div class="lead-card ${lead.paymentStatus} ${lead.priority ? 'priority' : ''} bg-white/80 backdrop-blur-lg rounded-2xl p-6 card-hover animate-in">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900">${lead.leadName}</h3>
                                <p class="text-sm text-gray-600">${lead.phoneNumber}</p>
                                ${lead.chatId ? `<p class="text-sm text-gray-500">${lead.chatId}</p>` : ''}
                            </div>
                            <div class="flex items-center space-x-2">
                                ${lead.priority ? `
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                        –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π
                                    </span>
                                ` : ''}
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                                    lead.paymentStatus === 'paid' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'
                                }">
                                    ${lead.paymentStatus === 'paid' ? '–û–ø–ª–∞—á–µ–Ω–æ' : '–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã'}
                                </span>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <p class="text-sm text-gray-500">–°—É–º–º–∞ —Å–¥–µ–ª–∫–∏</p>
                                <p class="text-lg font-semibold text-gray-900">${formatCurrency(lead.paymentAmount || 0)}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">–°—Ç–∞—Ç—É—Å</p>
                                <p class="text-sm font-medium text-gray-900">${lead.stage}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">–ò—Å—Ç–æ—á–Ω–∏–∫</p>
                                <p class="text-sm font-medium text-gray-900">${lead.callSource}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">–ú–µ–Ω–µ–¥–∂–µ—Ä</p>
                                <p class="text-sm font-medium text-gray-900">${lead.manager}</p>
                            </div>
                        </div>
                        
                        ${lead.individualRequest ? `
                            <div class="mb-4">
                                <p class="text-sm text-gray-500 mb-1">–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å</p>
                                <p class="text-sm text-gray-700 bg-gray-50 p-3 rounded-lg">${lead.individualRequest}</p>
                            </div>
                        ` : ''}
                        
                        <div class="flex justify-between items-center">
                            <div class="flex space-x-2">
                                <button onclick="callCenterDashboard.startCall(${lead.id})" 
                                        class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors">
                                    üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å
                                </button>
                                <button onclick="callCenterDashboard.viewLeadDetails(${lead.id})" 
                                        class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                                    –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏
                                </button>
                            </div>
                            
                            <!-- Call Attempts -->
                            <div class="flex items-center space-x-2">
                                <span class="text-xs text-gray-500">–ü–æ–ø—ã—Ç–æ–∫:</span>
                                ${this.getCallAttemptsCount(lead)}
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            getCallAttemptsCount(lead) {
                const attempts = window.crm?.callAttempts.filter(attempt => attempt.leadId === lead.id) || [];
                const colors = ['bg-gray-100 text-gray-800', 'bg-yellow-100 text-yellow-800', 'bg-orange-100 text-orange-800', 'bg-red-100 text-red-800'];
                const colorIndex = Math.min(attempts.length, colors.length - 1);
                
                return `<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${colors[colorIndex]}">
                    ${attempts.length}
                </span>`;
            }

            setupFilters() {
                const searchInput = document.getElementById('leadsSearch');
                const filterSelect = document.getElementById('leadsFilter');
                
                if (searchInput) {
                    searchInput.addEventListener('input', () => this.filterAssignedLeads());
                }
                
                if (filterSelect) {
                    filterSelect.addEventListener('change', () => this.filterAssignedLeads());
                }
            }

            filterAssignedLeads() {
                const searchTerm = document.getElementById('leadsSearch')?.value.toLowerCase() || '';
                const filterValue = document.getElementById('leadsFilter')?.value || 'all';
                
                let assignedLeads = this.getAssignedLeads();
                
                // Filter by search term
                if (searchTerm) {
                    assignedLeads = assignedLeads.filter(lead => 
                        lead.leadName.toLowerCase().includes(searchTerm) ||
                        lead.phoneNumber.includes(searchTerm)
                    );
                }
                
                // Filter by status
                if (filterValue !== 'all') {
                    switch (filterValue) {
                        case 'priority':
                            assignedLeads = assignedLeads.filter(lead => lead.priority);
                            break;
                        case 'paid':
                            assignedLeads = assignedLeads.filter(lead => lead.paymentStatus === 'paid');
                            break;
                        default:
                            assignedLeads = assignedLeads.filter(lead => lead.status === filterValue);
                    }
                }
                
                this.renderFilteredLeads(assignedLeads);
            }

            renderFilteredLeads(leads) {
                const container = document.getElementById('assignedLeadsList');
                
                if (leads.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-12">
                            <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                            <h3 class="text-lg font-medium text-gray-900 mb-2">–õ–∏–¥—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                            <p class="text-gray-500">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞</p>
                        </div>
                    `;
                    return;
                }
                
                // Re-render filtered leads with the same structure
                container.innerHTML = leads.map(lead => `
                    <div class="lead-card ${lead.paymentStatus} ${lead.priority ? 'priority' : ''} bg-white/80 backdrop-blur-lg rounded-2xl p-6 card-hover animate-in">
                        <!-- Same HTML structure as in loadAssignedLeads method -->
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900">${lead.leadName}</h3>
                                <p class="text-sm text-gray-600">${lead.phoneNumber}</p>
                                ${lead.chatId ? `<p class="text-sm text-gray-500">${lead.chatId}</p>` : ''}
                            </div>
                            <div class="flex items-center space-x-2">
                                ${lead.priority ? `
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                        –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π
                                    </span>
                                ` : ''}
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                                    lead.paymentStatus === 'paid' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'
                                }">
                                    ${lead.paymentStatus === 'paid' ? '–û–ø–ª–∞—á–µ–Ω–æ' : '–û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã'}
                                </span>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div>
                                <p class="text-sm text-gray-500">–°—É–º–º–∞ —Å–¥–µ–ª–∫–∏</p>
                                <p class="text-lg font-semibold text-gray-900">${formatCurrency(lead.paymentAmount || 0)}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">–°—Ç–∞—Ç—É—Å</p>
                                <p class="text-sm font-medium text-gray-900">${lead.stage}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">–ò—Å—Ç–æ—á–Ω–∏–∫</p>
                                <p class="text-sm font-medium text-gray-900">${lead.callSource}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">–ú–µ–Ω–µ–¥–∂–µ—Ä</p>
                                <p class="text-sm font-medium text-gray-900">${lead.manager}</p>
                            </div>
                        </div>
                        
                        ${lead.individualRequest ? `
                            <div class="mb-4">
                                <p class="text-sm text-gray-500 mb-1">–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å</p>
                                <p class="text-sm text-gray-700 bg-gray-50 p-3 rounded-lg">${lead.individualRequest}</p>
                            </div>
                        ` : ''}
                        
                        <div class="flex justify-between items-center">
                            <div class="flex space-x-2">
                                <button onclick="callCenterDashboard.startCall(${lead.id})" 
                                        class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors">
                                    üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å
                                </button>
                                <button onclick="callCenterDashboard.viewLeadDetails(${lead.id})" 
                                        class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                                    –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏
                                </button>
                            </div>
                            
                            <!-- Call Attempts -->
                            <div class="flex items-center space-x-2">
                                <span class="text-xs text-gray-500">–ü–æ–ø—ã—Ç–æ–∫:</span>
                                ${this.getCallAttemptsCount(lead)}
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            startCall(leadId) {
                const lead = window.crm?.leads.find(l => l.id === leadId);
                if (!lead) return;
                
                this.activeCallLead = lead;
                this.callStartTime = new Date();
                
                // Show active call interface
                document.getElementById('noActiveCall').classList.add('hidden');
                document.getElementById('activeCallInterface').classList.remove('hidden');
                
                // Populate lead info
                this.populateActiveLeadInfo(lead);
                
                // Start call timer
                this.startCallTimer();
                
                // Switch to active call section
                this.showSection('active-call');
                
                if (window.crm) {
                    window.crm.showNotification(`–ù–∞—á–∞—Ç –∑–≤–æ–Ω–æ–∫: ${lead.leadName}`, 'info');
                }
            }

            populateActiveLeadInfo(lead) {
                const container = document.getElementById('activeLeadInfo');
                container.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-xl font-bold text-gray-900">${lead.leadName}</h3>
                            <p class="text-gray-600">${lead.phoneNumber}</p>
                            ${lead.chatId ? `<p class="text-sm text-gray-500">${lead.chatId}</p>` : ''}
                        </div>
                        <div class="text-right">
                            <p class="text-sm text-gray-500">–°—É–º–º–∞ —Å–¥–µ–ª–∫–∏</p>
                            <p class="text-2xl font-bold text-green-600">${formatCurrency(lead.paymentAmount || 0)}</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <p class="text-sm text-gray-500">–ú–µ–Ω–µ–¥–∂–µ—Ä</p>
                            <p class="font-medium">${lead.manager}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">–ò—Å—Ç–æ—á–Ω–∏–∫</p>
                            <p class="font-medium">${lead.callSource}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">–°—Ç–∞—Ç—É—Å</p>
                            <p class="font-medium">${lead.stage}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-500">–û–ø–ª–∞—Ç–∞</p>
                            <p class="font-medium">${lead.paymentStatus === 'paid' ? '–û–ø–ª–∞—á–µ–Ω–æ' : '–û–∂–∏–¥–∞–µ—Ç'}</p>
                        </div>
                    </div>
                    
                    ${lead.individualRequest ? `
                        <div class="script-highlight p-4 rounded-lg">
                            <p class="text-sm font-medium text-amber-800 mb-1">–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å</p>
                            <p class="text-sm text-amber-700">${lead.individualRequest}</p>
                        </div>
                    ` : ''}
                `;
            }

            startCallTimer() {
                this.callTimer = setInterval(() => {
                    if (!this.callStartTime) return;
                    
                    const now = new Date();
                    const elapsed = now - this.callStartTime;
                    const minutes = Math.floor(elapsed / 1000 / 60);
                    const seconds = Math.floor((elapsed / 1000) % 60);
                    
                    const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    
                    const callTimerElement = document.getElementById('callTimer');
                    if (callTimerElement) {
                        callTimerElement.textContent = timeString;
                        callTimerElement.classList.remove('hidden');
                    }
                    
                    const endCallBtn = document.getElementById('endCallBtn');
                    if (endCallBtn) {
                        endCallBtn.classList.remove('hidden');
                    }
                }, 1000);
            }

            markCallStatus(status) {
                if (!this.activeCallLead || !this.callStartTime) return;
                
                const callDuration = Math.floor((new Date() - this.callStartTime) / 1000 / 60); // minutes
                const notes = document.getElementById('callNotes')?.value || '';
                
                const callAttempt = {
                    id: Date.now(),
                    leadId: this.activeCallLead.id,
                    operatorId: window.crm.currentUser.id,
                    attemptNumber: (window.crm.callAttempts.filter(a => a.leadId === this.activeCallLead.id).length + 1),
                    callResult: status,
                    notes: notes,
                    timestamp: new Date().toLocaleString('ru-RU'),
                    duration: callDuration
                };
                
                window.crm.callAttempts.push(callAttempt);
                window.crm.saveToStorage();
                
                // Notify TTC operator
                window.crm.createNotification(
                    'call_completed',
                    `–ó–≤–æ–Ω–æ–∫ –ø–æ ${this.activeCallLead.leadName}: ${status}`,
                    'ttc',
                    this.activeCallLead.createdBy
                );
                
                // End call
                this.endCall();
                
                // Update lead status based on call result
                let newStatus = this.activeCallLead.status;
                if (status === 'done') {
                    newStatus = 'done';
                } else if (status === 'busy' || status === 'no_answer') {
                    newStatus = 'in_progress';
                }
                
                window.crm.updateLead(this.activeCallLead.id, { status: newStatus });
                
                window.crm.showNotification(`–ó–≤–æ–Ω–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω: ${status}`, 'success');
                this.loadDashboard();
            }

            endCall() {
                if (this.callTimer) {
                    clearInterval(this.callTimer);
                    this.callTimer = null;
                }
                
                this.activeCallLead = null;
                this.callStartTime = null;
                
                // Reset UI
                document.getElementById('callTimer').classList.add('hidden');
                document.getElementById('endCallBtn').classList.add('hidden');
                document.getElementById('activeCallInterface').classList.add('hidden');
                document.getElementById('noActiveCall').classList.remove('hidden');
                
                // Clear notes
                const notesElement = document.getElementById('callNotes');
                if (notesElement) {
                    notesElement.value = '';
                }
            }

            saveCallNotes() {
                const notes = document.getElementById('callNotes')?.value;
                if (notes && window.crm) {
                    window.crm.showNotification('–ó–∞–º–µ—Ç–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
                }
            }

            loadScripts() {
                const scripts = window.crm?.scripts || [];
                const container = document.getElementById('scriptsList');
                
                container.innerHTML = scripts.map(script => `
                    <div class="script-item border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow" data-category="${script.category}">
                        <div class="flex justify-between items-start mb-3">
                            <h4 class="text-lg font-medium text-gray-900">${script.scriptName}</h4>
                            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                ${script.category}
                            </span>
                        </div>
                        <p class="text-sm text-gray-700 leading-relaxed">${script.scriptContent}</p>
                        <div class="mt-3 text-xs text-gray-500">
                            –û–±–Ω–æ–≤–ª–µ–Ω–æ: ${formatDate(script.updatedAt)}
                        </div>
                    </div>
                `).join('') || '<p class="text-gray-500 text-center py-8">–°–∫—Ä–∏–ø—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
            }

            setupAttendance() {
                const clockInBtn = document.getElementById('clockInBtn');
                const clockOutBtn = document.getElementById('clockOutBtn');
                
                clockInBtn?.addEventListener('click', () => this.clockIn());
                clockOutBtn?.addEventListener('click', () => this.clockOut());
                
                this.updateAttendanceUI();
            }

            clockIn() {
                this.attendanceStartTime = new Date();
                localStorage.setItem('callcenter_attendance_start', this.attendanceStartTime.toISOString());
                
                this.updateAttendanceUI();
                this.startWorkTimer();
                
                if (window.crm) {
                    window.crm.showNotification('–í—ã –Ω–∞—á–∞–ª–∏ —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å', 'success');
                }
            }

            clockOut() {
                if (!this.attendanceStartTime) return;
                
                this.attendanceStartTime = null;
                localStorage.removeItem('callcenter_attendance_start');
                
                this.updateAttendanceUI();
                this.stopWorkTimer();
                
                if (window.crm) {
                    window.crm.showNotification('–í—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å', 'success');
                }
            }

            updateAttendanceUI() {
                const clockInBtn = document.getElementById('clockInBtn');
                const clockOutBtn = document.getElementById('clockOutBtn');
                
                if (this.attendanceStartTime) {
                    clockInBtn?.classList.add('hidden');
                    clockOutBtn?.classList.remove('hidden');
                } else {
                    clockInBtn?.classList.remove('hidden');
                    clockOutBtn?.classList.add('hidden');
                }
            }

            startWorkTimer() {
                this.workTimer = setInterval(() => {
                    if (!this.attendanceStartTime) return;
                    
                    const now = new Date();
                    const elapsed = now - this.attendanceStartTime;
                    const hours = Math.floor(elapsed / 1000 / 60 / 60);
                    const minutes = Math.floor((elapsed / 1000 / 60) % 60);
                    const seconds = Math.floor((elapsed / 1000) % 60);
                    
                    const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    
                    const workTimeElement = document.getElementById('workTime');
                    if (workTimeElement) {
                        workTimeElement.textContent = timeString;
                    }
                }, 1000);
            }

            stopWorkTimer() {
                if (this.workTimer) {
                    clearInterval(this.workTimer);
                    this.workTimer = null;
                }
                
                const workTimeElement = document.getElementById('workTime');
                if (workTimeElement) {
                    workTimeElement.textContent = '00:00:00';
                }
            }

            viewLeadDetails(leadId) {
                // Reuse the same modal as in TTC dashboard
                const lead = window.crm?.leads.find(l => l.id === leadId);
                const callAttempts = window.crm?.callAttempts.filter(attempt => attempt.leadId === leadId) || [];
                
                if (!lead) return;
                
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-2xl font-bold">${lead.leadName}</h3>
                            <button onclick="this.parentElement.parentElement.parentElement.remove()" class="text-gray-400 hover:text-gray-600">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <p class="text-sm text-gray-500">–¢–µ–ª–µ—Ñ–æ–Ω</p>
                                    <p class="font-medium">${lead.phoneNumber}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">–°—É–º–º–∞</p>
                                    <p class="font-medium">${formatCurrency(lead.paymentAmount || 0)}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">–ú–µ–Ω–µ–¥–∂–µ—Ä</p>
                                    <p class="font-medium">${lead.manager}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">–û–ø–ª–∞—Ç–∞</p>
                                    <p class="font-medium">${lead.paymentStatus === 'paid' ? '–û–ø–ª–∞—á–µ–Ω–æ' : '–û–∂–∏–¥–∞–µ—Ç'}</p>
                                </div>
                            </div>
                            
                            ${lead.individualRequest ? `
                                <div>
                                    <p class="text-sm text-gray-500 mb-2">–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å</p>
                                    <p class="bg-gray-50 p-3 rounded-lg">${lead.individualRequest}</p>
                                </div>
                            ` : ''}
                            
                            <div>
                                <h4 class="font-semibold mb-2">–ò—Å—Ç–æ—Ä–∏—è –∑–≤–æ–Ω–∫–æ–≤ (${callAttempts.length})</h4>
                                ${callAttempts.length > 0 ? `
                                    <div class="space-y-2">
                                        ${callAttempts.map(attempt => `
                                            <div class="bg-gray-50 p-3 rounded-lg">
                                                <div class="flex justify-between items-center">
                                                    <span class="text-sm font-medium">–ü–æ–ø—ã—Ç–∫–∞ #${attempt.attemptNumber}</span>
                                                    <span class="text-xs text-gray-500">${attempt.timestamp}</span>
                                                </div>
                                                <p class="text-sm mt-1">–†–µ–∑—É–ª—å—Ç–∞—Ç: ${attempt.callResult}</p>
                                                ${attempt.notes ? `<p class="text-sm text-gray-600 mt-1">${attempt.notes}</p>` : ''}
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : '<p class="text-sm text-gray-500">–ó–≤–æ–Ω–∫–æ–≤ –ø–æ–∫–∞ –Ω–µ –±—ã–ª–æ</p>'}
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
            }

            loadStats() {
                const myCallAttempts = window.crm?.callAttempts.filter(attempt => 
                    attempt.operatorId === window.crm.currentUser.id
                ) || [];
                
                const successfulCalls = myCallAttempts.filter(attempt => attempt.callResult === 'done').length;
                const avgCallTime = myCallAttempts.reduce((sum, attempt) => sum + (attempt.duration || 0), 0) / myCallAttempts.length || 0;
                
                document.getElementById('totalCalls').textContent = myCallAttempts.length;
                document.getElementById('successfulCalls').textContent = successfulCalls;
                document.getElementById('avgCallTime').textContent = Math.round(avgCallTime) + ' –º–∏–Ω';
            }

            initializeCharts() {
                // Performance chart
                const performanceChart = echarts.init(document.getElementById('performanceChart'));
                performanceChart.setOption({
                    tooltip: { trigger: 'axis' },
                    xAxis: {
                        type: 'category',
                        data: ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å']
                    },
                    yAxis: { type: 'value' },
                    series: [{
                        data: [12, 15, 8, 18, 10, 6, 4],
                        type: 'line',
                        smooth: true,
                        itemStyle: { color: '#3b82f6' },
                        areaStyle: { opacity: 0.3 }
                    }]
                });

                // Call results chart
                const callResultsChart = echarts.init(document.getElementById('callResultsChart'));
                callResultsChart.setOption({
                    tooltip: { trigger: 'item' },
                    series: [{
                        type: 'pie',
                        radius: '70%',
                        data: [
                            { value: 65, name: '–£—Å–ø–µ—à–Ω–æ', itemStyle: { color: '#10b981' } },
                            { value: 25, name: '–ó–∞–Ω—è—Ç–æ', itemStyle: { color: '#f59e0b' } },
                            { value: 10, name: '–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞', itemStyle: { color: '#ef4444' } }
                        ],
                        emphasis: {
                            itemStyle: {
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    }]
                });
            }
        }

        // Global functions for script filtering
        function filterScripts(category) {
            const scriptItems = document.querySelectorAll('.script-item');
            
            scriptItems.forEach(item => {
                if (category === 'all' || item.dataset.category === category) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
            
            // Update active category button
            document.querySelectorAll('[onclick^="filterScripts"]').forEach(btn => {
                btn.className = 'w-full text-left px-3 py-2 rounded-lg hover:bg-gray-50 text-gray-700 text-sm';
            });
            
            event.target.className = 'w-full text-left px-3 py-2 rounded-lg bg-blue-50 text-blue-700 text-sm font-medium';
        }

        // Initialize call center dashboard when page loads
        document.addEventListener('DOMContentLoaded', () => {
            if (window.crm && window.crm.currentUser && window.crm.currentUser.role === 'callcenter') {
                window.callCenterDashboard = new CallCenterDashboard();
                
                // Load saved attendance state
                const savedStartTime = localStorage.getItem('callcenter_attendance_start');
                if (savedStartTime) {
                    window.callCenterDashboard.attendanceStartTime = new Date(savedStartTime);
                    window.callCenterDashboard.updateAttendanceUI();
                    window.callCenterDashboard.startWorkTimer();
                }
            } else {
                window.location.href = 'index.html';
            }
        });
    </script>
</body>
</html>